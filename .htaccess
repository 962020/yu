<IfModule pagespeed_module>
  ModPagespeed off
</IfModule>

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresDefault A0
  ExpiresByType image/gif A691200
  ExpiresByType image/png A691200
  ExpiresByType image/jpeg A691200
  ExpiresByType text/css A691200
  ExpiresByType text/javascript A691200
  ExpiresByType application/javascript A691200
  ExpiresByType font/otf A691200
  ExpiresByType font/ttf A691200
  ExpiresByType font/woff A691200
  ExpiresByType font/woff2 A691200
</IfModule>

<FilesMatch "^(web\.config)$">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
  <IfModule !mod_authz_core.c>
    Order allow,deny
  </IfModule>
</FilesMatch>
ErrorDocument 401 "Unauthorized"
ErrorDocument 403 "Forbidden"
<IfModule mod_negotiation.c>
  #Options -MultiViews
</IfModule>
RewriteEngine On
RewriteBase /

# 强制 HTTPS 配置
RewriteCond %{HTTPS} !=on
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

RewriteCond %{HTTP:Authorization} ^(.*)
RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]
RewriteCond %{HTTP:X-Server-Addr} ^(.*)
RewriteRule .* - [e=HTTP_X_SERVER_ADDR:%1]
RewriteRule ^\.well-known/.+ - [L]

# 设置 WSGI 处理程序
AddHandler wsgi-script .py

# WSGI 重写规则 - 确保所有请求正确路由到Flask应用
# 路由所有API相关请求到WSGI应用
RewriteCond %{REQUEST_URI} ^/(login|register|api|logout) [NC]
RewriteRule ^(.*)$ wsgi.py/$1 [L]

# 确保所有HTML文件都直接路由到WSGI应用
RewriteCond %{REQUEST_URI} \.html$ [NC]
RewriteRule ^(.*)$ wsgi.py/$1 [L]

# 为wsgi.py文件启用执行权限
<Files wsgi.py>
    Options +ExecCGI
    SetHandler wsgi-script
</Files>

# 静态文件优先处理
DirectoryIndex index.php index.cgi index.html wsgi.py

# 自定义错误页面
ErrorDocument 404 /index.html

# 持久内容重定向
Redirect 301 /1.html https://qqaitiaoyu.dpdns.org/login.html